---
title: "008 Lumen Middleware"
date: 2020-08-03T21:25:55+08:00
draft: true
---

### Lumen 中间件源码解析

#### 什么是中间件

- 中间件（Middleware）通常是指在一个大型分布式的系统中，负责各个不同组件（Component）/服务（Service）之间管理以及交互数据的。

- 中间件的本质就是一个函数，在收到请求和返回相应的过程中做一些我们想做的事情。

#### 中间件的分类

- 路由中间件
- 全局中间件

#### 中间件能做什么
可以实现业务与非业务逻辑的隔离

- 为本次请求生成单独的requestid,可一路透传,用来生成分布式的链路,也可用于在日志中串连单次请求的所有逻辑。
- 校验web管理页面的token，判断用户登录信息是否失效。
- 对HTTP的响应体进行压缩(对php来说，一般放在Nginx中使用gzip对响应结构进行压缩)，从请求头中读取X-Forwarded-For 和 X-Real-IP,将http.Request中的RemoteAttr修改为得到的RealIP。
- 打印请求处理日志，统计单次请求各个阶段的耗时工作。



